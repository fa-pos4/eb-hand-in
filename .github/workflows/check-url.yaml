name: Check Unique Deployment  
on: [push]
jobs:
  check-url:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Verify URL ownership and availability
        run: |
          # 1. URL einlesen + Whitespace entfernen  
          URL=$(cat deployment_url.txt | tr -d '[:space:]')
          
          # 2. GitHub Username des Schülers holen  
          STUDENT_USER="${{ github.actor }}"
          
          echo "Prüfe URL: $URL"
          echo "Von User: $STUDENT_USER"

          # 3. Check: Enthält die URL den git user?
          # Umwandlung in lowercase und prüfen ob user substring der URL  
          if [[ "${URL,,}" != *"${STUDENT_USER,,}"* ]]; then
            echo "❌ FEHLER: Die URL muss deinen git user enthalten!"
            echo "Das stellt sicher, dass du deine eigene AWS-Umgebung erstellt hast."
            exit 1
          fi

          # 3. Check: Ist die URL erreichbar?
          if curl --output /dev/null --silent --head --fail "$URL"; then
            echo "✅ URL ist online und gehört dir!"
          else
            echo "❌ FEHLER: URL ist nicht erreichbar (Status Code nicht 200)."
            exit 1
          fi          